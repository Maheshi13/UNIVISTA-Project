<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIVISTA - Post New Event</title>
    <link rel="stylesheet" href="css/style.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    
    <style>
        /* General form container and header styles */
        .form-container.post-event-form {
            max-width: 900px;
            padding: 40px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin: 50px auto; 
        }
        .form-container.post-event-form h2 {
            font-family: 'Great Vibes', cursive;
            font-size: 2.5rem; 
            font-weight: normal; 
            margin-bottom: 30px; 
            text-align: center;
            color: #000000; 
        }
        .placeholder-grey:required:invalid {
            color: #888; 
        }
        .placeholder-grey option {
            color: #333; 
        }

        /* Multistep Form Logic Styles */
        .form-section { display: none; }
        .form-section.active { display: block; }

        /* Step Navigation Styles */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            gap: 10px;
        }

        /* Updated button layout to always show both back and next/submit */
        .step-navigation .nav-spacer {
            flex: 1;
        }

        /* Input and Button Styling */
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group input[type="time"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1rem;
        }
        .form-group-inline {
            display: flex;
            gap: 20px;
        }
        .form-group-inline > .form-group {
            flex: 1;
        }
        
        /* Flexbox container for Poster and Details */
        .top-details-container { 
            display: flex;
            gap: 30px; 
            margin-bottom: 20px;
        }

        .event-poster-group {
            flex: 0 0 40%; 
            max-width: 40%;
        }

        .event-details-group {
            flex: 1; 
        }
        
        /* Responsive adjustment for smaller screens */
        @media (max-width: 768px) {
            .top-details-container {
                flex-direction: column; 
            }
            .event-poster-group, .event-details-group {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }

        /* Audience and Ticket Button Styles */
        .audience-options, .ticket-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        .audience-options label, .ticket-options label {
            background-color: #ffffff;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-weight: 500;
        }
        .audience-options input:checked + label, .ticket-options input:checked + label {
            background-color: #007bff;
            color: white;
        }
        .audience-options input, .ticket-options input {
            display: none;
        }
        
        /* Submit/Next/Back Button Style */
        .form-button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            white-space: nowrap;
        }
        .form-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        #next-button, #submit-button { background-color: #134c88; }
        #back-button { background-color: #6c757d; }
        #submit-button { background-color: #28a745; }

        /* Summary Step Styles */
        .summary-details { text-align: left; }
        /* CHANGED: Summary headers from blue to black */
        .summary-details h3 {
            border-bottom: 2px solid #333; /* Changed from #007bff */
            padding-bottom: 5px;
            margin-top: 20px;
            font-size: 1.5rem;
            color: #333; /* Ensures text is not blue */
        }
        .summary-item {
            padding: 10px 0;
            border-bottom: 1px dashed #ddd;
        }
        .summary-item strong {
            display: inline-block;
            width: 150px;
            color: #333;
        }
        
        /* Style for Account Information Box */
        .account-info-box {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            background-color: #f8f8f8;
        }
        .account-info-box h4 {
            margin-top: 0;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        /* Event Poster Drag & Drop Area Styles (Step 1) */
        #poster-upload-area {

            text-align: center;
            cursor: pointer;
            background-color: #fcfcfc;
            transition: background-color 0.3s, border-color 0.3s;
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            padding: 40px;
            width: 800px;
            max-width: 70%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            position: relative;
        }

        #poster-upload-area:hover,
        #poster-upload-area.drag-over {
            background-color: #e9f5ff;
            border-color: #007bff;
        }

        #poster-upload-area .main-text {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        #poster-upload-area .sub-text {
            font-size: 1.1em;
            color: #777;
        }
        
        /* Poster preview image - use object-fit contain to keep aspect ratio */
        #poster-preview-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 4px;
            display: none;
        }
        
        /* Other utility styles */
        .faculty-list-group {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        /* Removed #current-step-display styles */
        /* #current-step-display {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #007bff;
            font-weight: bold;
        } */

        /* --- START: MODIFIED STYLES FOR SUMMARY POSTER (STEP 2) --- */
        
        /* General wrapper for summary poster */
        .summary-poster-container-wrapper {
            margin-bottom: 20px;
        }

        /* Poster preview container for Summary Step (Removed borders/backgrounds) */
        .poster-preview-container {
            width: 100%;
            height: 320px; /* Adjusted height for better display */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #888;
            border-radius: 8px;
            overflow: hidden;
            text-align: center;
            padding: 0; /* Removed padding */
        }
        
        .poster-preview-container img {
            width: 100%;
            max-width: 100%;
            height: 100%;
            max-height: 320px;
            object-fit: contain; /* Ensures image fits within the container without cropping */
            border-radius: 6px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* --- END: MODIFIED STYLES FOR SUMMARY POSTER (STEP 2) --- */
    </style>
</head>
<body>
    <div class="background-overlay"></div>
    <header class="navbar">
        <div class="navbar-left">
            <img src="https://cmb.ac.lk/wp-content/uploads/logo-web.png" alt="University Logo" class="university-logo">
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="main.html">Events</a></li>
                    <li><a href="about.html">About</a></li>
                </ul>
            </nav>
        </div>
        <div class="navbar-right">
            <img src="https://cmb.ac.lk/wp-content/uploads/logo-web.png" alt="UNIVISTA Logo" class="univista-logo">
        </div>
    </header>

    <div class="form-container post-event-form">
        <h2>All Great Events Start with a Click - Share Yours Now!</h2>   
        <form id="post-event-form">
            <div id="step-1" class="form-section active">
                
                <div class="top-details-container"> 
                    
                    <div class="form-group event-poster-group">
                        <label>Event Poster *</label>
                        <div id="poster-upload-area">
                            <input type="file" id="event-poster" accept="image/*" required>
                            <p class="main-text">EVENT POSTER</p>
                            <p class="sub-text">Drag & Drop Image Here or</p>
                            <p class="sub-text">Click to Upload</p>
                            <img id="poster-preview-img" src="#" alt="Poster Preview">
                        </div>
                    </div>

                    <div class="event-details-group">
                        <div class="form-group">
                            <label for="event-name">Event Name *</label>
                            <input type="text" id="event-name" required>
                        </div>
                        
                        <div class="form-group-inline">
                            <div class="form-group">
                                <label for="event-date">Event Date *</label>
                                <input type="date" id="event-date" required>
                            </div>
                            <div class="form-group">
                                <label for="event-time">Event Time *</label>
                                <input type="time" id="event-time" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="event-location">Event Location *</label>
                            <input type="text" id="event-location" placeholder="e.g., Main Auditorium, UCSC Building" required>
                        </div>

                        <div class="form-group-inline">
                            <div class="form-group">
                                <label for="event-category">Event Category *</label>
                                <select id="event-category" required class="placeholder-grey"> 
                                    <option value="" disabled selected>Select Category</option>
                                    <option value="academic">Academic</option>
                                    <option value="sports">Sports</option>
                                    <option value="cultural">Cultural</option>
                                    <option value="social">Social</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="hosting-faculty">Hosting Faculty *</label>
                                <input type="text" id="hosting-faculty" readonly required value="" placeholder="Auto-filled by Registration">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="event-description">Event Description *</label>
                    <textarea id="event-description" rows="5" required></textarea>
                </div>

                <div class="form-group-inline">
                    <div class="form-group">
                        <label for="contact-number-1">Contact Number *</label>
                        <input type="text" id="contact-number-1" placeholder="e.g., 077-123 4567" required>
                    </div>
                    <div class="form-group">
                        <label for="contact-number-2">Contact Number (Optional)</label>
                        <input type="text" id="contact-number-2" placeholder="e.g., 077-123 4567">
                    </div>
                </div>

                <div class="form-group">
                    <label>Audience Type *</label>
                    <div class="audience-options">
                        <input type="checkbox" id="audience-members" name="audience-type" value="members">
                        <label for="audience-members">University Members</label>
                        
                        <input type="checkbox" id="audience-guests" name="audience-type" value="guests">
                        <label for="audience-guests">Guests/Public</label>
                    </div>
                </div>

                <div id="faculty-selection-group" class="form-group faculty-list-group" style="display:none;">
                    <label for="target-faculty">Target Faculties (for University Members)</label>
                    <select id="target-faculty" required class="placeholder-grey"> 
                        <option value="" disabled selected>Target Faculties</option>
                        <option value="all" selected>All Faculties</option>
                        <option value="Faculty of Science">Faculty of Science</option>
                        <option value="Faculty of Management and Financial">Faculty of Management and Financial</option>
                        <option value="University of Colombo School of Computing">University of Colombo School of Computing (UCSC)</option>
                        <option value="Faculty of Art">Faculty of Art</option>
                        <option value="Faculty of Law">Faculty of Law</option>
                        <option value="Faculty of Education">Faculty of Education</option>
                        <option value="Faculty of Technology">Faculty of Technology</option>
                        <option value="Faculty of Nursing">Faculty of Nursing</option>
                        <option value="Sripalee Campus">Sripalee Campus</option>
                        <option value="Faculty of Indigenous Medicine">Faculty of Indigenous Medicine</option>
                        <option value="Faculty of Medicine">Faculty of Medicine</option>
                    </select>
               </div>

                <div class="form-group">
                    <label>Ticket Status *</label>
                    <div class="ticket-options">
                        <input type="radio" id="financial-yes" name="financial-type" value="financial" required>
                        <label for="financial-yes">Paid</label>
                        
                        <input type="radio" id="financial-no" name="financial-type" value="non-financial">
                        <label for="financial-no">Free-Entry</label>
                    </div>
                </div>

                <div id="financial-details-group" style="display:none;">
                    <h4 style="margin-top: 20px; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Price & Ticket Details</h4>
                    <div class="form-group-inline">
                        <div class="form-group">
                            <label for="special-rate">Price (LKR) *</label>
                            <input type="number" id="special-rate" min="0" step="0.01" placeholder="Price for University Members">
                        </div>
                        <div class="form-group">
                            <label for="general-price">Guests (LKR) *</label>
                            <input type="number" id="general-price" min="0" step="0.01" placeholder="Price for Guests/Public">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="tickets-available-new">Available Tickets *</label>
                        <input type="number" id="tickets-available-new" min="1" placeholder="Number of tickets">
                    </div>

                    <div id="account-info-group" class="account-info-box">
                        <h4>Account Information</h4>
                        <div class="form-group-inline">
                            <div class="form-group">
                                <label for="beneficiary-name">Beneficiary Name: *</label>
                                <input type="text" id="beneficiary-name" placeholder="Enter Beneficiary Name">
                            </div>
                            <div class="form-group">
                                <label for="account-number">Account Number: *</label>
                                <input type="text" id="account-number" placeholder="Enter Account Number">
                            </div>
                        </div>
                        <div class="form-group-inline">
                            <div class="form-group">
                                <label for="bank-name">Bank Name: *</label>
                                <select id="bank-name" class="placeholder-grey">
                                    <option value="" disabled selected>Select Bank Name</option>
                                    <option value="BOC">Bank of Ceylon (BOC)</option>
                                    <option value="Commercial">Commercial Bank</option>
                                    <option value="Sampath">Sampath Bank</option>
                                    <option value="HNB">Hatton National Bank (HNB)</option>
                                    <option value="People's">People's Bank</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="branch-name">Branch Name: *</label>
                                <input type="text" id="branch-name" placeholder="Enter Branch Name">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="step-2" class="form-section">
                <h3>Event Post Summary</h3>
                
                <div class="summary-poster-container-wrapper"> 
                    <div class="poster-preview-container">
                        <img id="summary-poster-preview" src="/placeholder.svg" alt="Event Poster Preview">
                    </div>
                    <p id="summary-poster-name-text" style="text-align: center; margin-top: 10px;">No file selected.</p>
                </div>

                <div class="summary-details">
                    
                    <h3 style="margin-top: 30px;">Event Details</h3>
                    <div class="summary-item"><strong>Name:</strong> <span id="summary-name"></span></div>
                    <div class="summary-item"><strong>Date & Time:</strong> <span id="summary-datetime"></span></div>
                    <div class="summary-item"><strong>Location:</strong> <span id="summary-location"></span></div>
                    <div class="summary-item"><strong>Category:</strong> <span id="summary-category"></span></div>
                    <div class="summary-item"><strong>Hosting Faculty:</strong> <span id="summary-host-faculty"></span></div>
                    <div class="summary-item"><strong>Audience:</strong> <span id="summary-audience"></span></div>
                    <div class="summary-item" id="summary-target-faculty-item" style="display:none;"><strong>Target Faculty:</strong> <span id="summary-target-faculty"></span></div>
                    <div class="summary-item"><strong>Contact:</strong> <span id="summary-contact"></span></div>
                    
                    <h3 style="margin-top: 30px;">Description</h3>
                    <p id="summary-description" style="white-space: pre-wrap; margin-bottom: 20px; padding: 10px; border: 1px dashed #eee;"></p>
                    
                    <h3 style="margin-top: 30px;">Financial Summary</h3>
                    <div class="summary-item"><strong>Ticket Status:</strong> <span id="summary-financial-type"></span></div>
                    
                    <div id="summary-financial-details-section" style="display:none;">
                        <div class="summary-item"><strong>Price (For University Members):</strong> <span id="summary-special-rate"></span></div>
                        <div class="summary-item"><strong>Price (For Guests):</strong> <span id="summary-general-price"></span></div>
                        <div class="summary-item"><strong>Number of Tickets:</strong> <span id="summary-tickets-available-new"></span></div>
                        
                        <h3>Account Information</h3>
                        <div class="summary-item"><strong>Beneficiary Name:</strong> <span id="summary-beneficiary-name"></span></div>
                        <div class="summary-item"><strong>Account Number:</strong> <span id="summary-account-number"></span></div>
                        <div class="summary-item"><strong>Bank Name:</strong> <span id="summary-bank-name"></span></div>
                        <div class="summary-item"><strong>Branch Name:</strong> <span id="summary-branch-name"></span></div>
                    </div>
                </div>
                
                <p style="margin-top: 30px; font-weight: bold; color: #dc3545;">
                    Note: Your submission will be sent to the Crew for approval before being published.
                </p>
            </div>

            <div class="step-navigation">
                <button type="button" id="back-button" class="form-button" style="display:none;">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <div class="nav-spacer"></div>
                <button type="button" id="next-button" class="form-button">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
                <button type="submit" id="submit-button" class="form-button" style="display:none; background-color: #28a745;">
                    <i class="fas fa-paper-plane"></i> Submit Event
                </button>
            </div>
        </form>
    </div>

    <footer><p>&copy; 2023 UNIVISTA. All rights reserved.</p></footer>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script> 
    
    <script src="firebase-config.js"></script>
    <script src="js/firestore.js"></script> 
    
    <script>
        let currentStep = 1;
        let eventPosterFile = null;

        
        // Sri Lankan phone number validation (format: 077-123 4567)
        function validateSriLankanPhoneNumber(phone) {
            const phoneRegex = /^0[0-9]{2}-[0-9]{3}\s[0-9]{4}$/;
            return phoneRegex.test(phone);
        }

        // Format phone number as user types
        function formatPhoneNumber(input) {
            let value = input.value.replace(/\D/g, ''); // Remove all non-digits
            if (value.length > 10) value = value.slice(0, 10); // Limit to 10 digits
            
            if (value.length === 0) {
                input.value = '';
            } else if (value.length <= 3) {
                input.value = value;
            } else if (value.length <= 6) {
                input.value = value.slice(0, 3) + '-' + value.slice(3);
            } else {
                input.value = value.slice(0, 3) + '-' + value.slice(3, 6) + ' ' + value.slice(6);
            }
        }

        // Format price as currency (00.00 format)
        function formatPrice(input) {
            let value = input.value.replace(/[^\d.]/g, ''); // Remove non-numeric except dot
            if (value) {
                value = parseFloat(value).toFixed(2);
            }
            input.value = value;
        }

        // Validate and format account number (numbers only)
        function validateAccountNumber(input) {
            input.value = input.value.replace(/[^0-9]/g, ''); // Remove all non-digits
        }

        // Convert beneficiary name to uppercase
        function formatBeneficiaryName(input) {
            input.value = input.value.toUpperCase();
        }

        // Format branch name (first letter capital, rest lowercase)
        function formatBranchName(input) {
            if (input.value.length > 0) {
                input.value = input.value.charAt(0).toUpperCase() + input.value.slice(1).toLowerCase();
            }
        }

        function showStep(step) {
            // REMOVED: const stepDisplay = document.getElementById('current-step-display');
            const nextButton = document.getElementById('next-button');
            const backButton = document.getElementById('back-button');
            const submitButton = document.getElementById('submit-button');

            // Hide all sections first
            document.getElementById('step-1').classList.remove('active');
            document.getElementById('step-2').classList.remove('active');

            // Show the new step
            currentStep = step;
            document.getElementById(`step-${currentStep}`).classList.add('active');

            // REMOVED: Logic to update step display text
            // const stepLabel = currentStep === 1 ? 'Event Details' : 'Summary & Submit';
            // stepDisplay.textContent = `Step ${currentStep} of 2: ${stepLabel}`;

            if (currentStep === 1) {
                // Step 1: Show only Next button
                backButton.style.display = 'none';
                nextButton.style.display = 'block';
                submitButton.style.display = 'none';
            } else if (currentStep === 2) {
                // Step 2: Show Back and Submit buttons
                backButton.style.display = 'block';
                nextButton.style.display = 'none';
                submitButton.style.display = 'block';
            }
        }

        function validateStep1() {
            const step1 = document.getElementById('step-1');
            const audienceCheckboxes = document.getElementsByName('audience-type');
            
            let isValid = true;

            const requiredInputs = step1.querySelectorAll('input[required], select[required], textarea[required]');
            requiredInputs.forEach(input => {
                if (input.type !== 'radio' && input.type !== 'checkbox' && input.id !== 'event-poster' && !input.checkValidity()) {
                    isValid = false;
                }
            });

            if (!isValid) {
                 for (const input of requiredInputs) {
                    if (input.type !== 'radio' && input.type !== 'checkbox' && input.id !== 'event-poster' && !input.checkValidity()) {
                        input.reportValidity();
                        return false;
                    }
                }
                return false; 
            }

            const contact1 = document.getElementById('contact-number-1').value;
            if (contact1 && !validateSriLankanPhoneNumber(contact1)) {
                alert("Contact Number 1 must be in format: 077-123 4567");
                return false;
            }

            const contact2 = document.getElementById('contact-number-2').value;
            if (contact2 && !validateSriLankanPhoneNumber(contact2)) {
                alert("Contact Number 2 must be in format: 077-123 4567");
                return false;
            }

            const financialYes = document.getElementById('financial-yes');
            const financialRadio = document.querySelector('input[name="financial-type"]:checked');

            if (!financialRadio) {
                alert("Please select a Financial Type (Financial or Non-financial).");
                return false;
            } else if (financialYes.checked) {
                const financialRequired = [
                    document.getElementById('special-rate'),
                    document.getElementById('general-price'),
                    document.getElementById('tickets-available-new'),
                    document.getElementById('beneficiary-name'), 
                    document.getElementById('account-number'),    
                    document.getElementById('bank-name'),        
                    document.getElementById('branch-name')       
                ];
                
                for (const input of financialRequired) {
                    if (!input.checkValidity()) {
                        input.reportValidity();
                        return false;
                    }
                }
            }

            let audienceChecked = Array.from(audienceCheckboxes).some(checkbox => checkbox.checked);
            if (!audienceChecked) {
                alert("Please select at least one Audience Type.");
                return false;
            }

            if (!eventPosterFile) {
                alert("Please upload an Event Poster.");
                return false;
            }
            
            return true;
        }

        function updateSummary() {
            const name = document.getElementById('event-name').value;
            const date = document.getElementById('event-date').value;
            const time = document.getElementById('event-time').value;
            const location = document.getElementById('event-location').value;
            const category = document.getElementById('event-category').value;
            const hostFaculty = document.getElementById('hosting-faculty').value;
            
            const contact1 = document.getElementById('contact-number-1').value;
            const contact2 = document.getElementById('contact-number-2').value;
            const combinedContact = contact2 ? `${contact1}, ${contact2}` : contact1;
            
            const description = document.getElementById('event-description').value;
            const targetFacultySelect = document.getElementById('target-faculty');
            const audienceMembers = document.getElementById('audience-members');
            
            const financialTypeRadio = document.querySelector('input[name="financial-type"]:checked');
            const financialType = financialTypeRadio ? financialTypeRadio.value : 'N/A';
            const isFinancial = financialType === 'financial';
            
            const ticketStatusDisplay = financialType === 'financial' ? 'Paid' : 'Free Entry';
            
            const summaryPosterPreview = document.getElementById('summary-poster-preview');
            const summaryPosterNameText = document.getElementById('summary-poster-name-text');

            document.getElementById('summary-name').textContent = name;
            document.getElementById('summary-datetime').textContent = `${date} at ${time}`;
            document.getElementById('summary-location').textContent = location;
            document.getElementById('summary-category').textContent = category.charAt(0).toUpperCase() + category.slice(1);
            document.getElementById('summary-host-faculty').textContent = hostFaculty || "UCSC (Mock)"; 
            
            document.getElementById('summary-contact').textContent = combinedContact;
            
            document.getElementById('summary-description').textContent = description;
            
            document.getElementById('summary-financial-type').textContent = ticketStatusDisplay;
            
            let audienceTypes = [];
            if (audienceMembers.checked) audienceTypes.push('University Members');
            if (document.getElementById('audience-guests').checked) audienceTypes.push('Guests/Public');
            document.getElementById('summary-audience').textContent = audienceTypes.join(' & ');

            if (audienceMembers.checked && document.getElementById('faculty-selection-group').style.display !== 'none') {
                document.getElementById('summary-target-faculty-item').style.display = 'block';
                const selectedOptions = Array.from(targetFacultySelect.selectedOptions).map(option => option.text);
                document.getElementById('summary-target-faculty').textContent = selectedOptions.join(', ');
            } else {
                document.getElementById('summary-target-faculty-item').style.display = 'none';
            }
            
            if (isFinancial) {
                document.getElementById('summary-financial-details-section').style.display = 'block';
                const specialRate = parseFloat(document.getElementById('special-rate').value).toFixed(2);
                const generalPrice = parseFloat(document.getElementById('general-price').value).toFixed(2);
                document.getElementById('summary-special-rate').textContent = `LKR ${specialRate}`;
                document.getElementById('summary-general-price').textContent = `LKR ${generalPrice}`;
                document.getElementById('summary-tickets-available-new').textContent = document.getElementById('tickets-available-new').value;

                document.getElementById('summary-beneficiary-name').textContent = document.getElementById('beneficiary-name').value;
                document.getElementById('summary-account-number').textContent = document.getElementById('account-number').value;
                document.getElementById('summary-bank-name').textContent = document.getElementById('bank-name').value;
                document.getElementById('summary-branch-name').textContent = document.getElementById('branch-name').value;

            } else {
                document.getElementById('summary-financial-details-section').style.display = 'none';
            }

            if (eventPosterFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    summaryPosterPreview.src = e.target.result;
                    summaryPosterPreview.style.display = 'block';
                    summaryPosterNameText.textContent = ''; // Hide the text when image is present
                };
                reader.readAsDataURL(eventPosterFile);
            } else {
                summaryPosterPreview.style.display = 'none';
                summaryPosterNameText.textContent = 'No poster file uploaded.';
            }
        }

        async function handleFormSubmission(e) {
            e.preventDefault();
            if (currentStep !== 2) return;
            
            const submitButton = document.getElementById('submit-button');
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';

            try {
                const mockUploadEventPoster = (file) => {
                    console.log(`MOCK: Uploading poster ${file.name}... Returning placeholder URL.`);
                    return new Promise(resolve => setTimeout(() => resolve(`https://example.com/posters/${Date.now()}-${file.name}`), 100));
                };

                const uploadFunc = (typeof uploadEventPoster === 'function') ? uploadEventPoster : mockUploadEventPoster;
                const posterURL = await uploadFunc(eventPosterFile); 
                const eventData = collectFormData(posterURL);
                
                console.log("MOCK: Event data collected:", eventData);

                alert("Event successfully submitted for Crew review! (MOCK SUBMISSION)");

            } catch (error) {
                console.error("Event submission failed:", error);
                alert(`Submission failed. Please check the console for details. Error: ${error.message}`);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Event';
            }
        }

        function collectFormData(posterURL) {
            const targetFacultySelect = document.getElementById('target-faculty');
            const audienceMembers = document.getElementById('audience-members');
            const targetFaculties = Array.from(targetFacultySelect.selectedOptions).map(option => option.value);
            
            const financialTypeRadio = document.querySelector('input[name="financial-type"]:checked');
            const financialType = financialTypeRadio ? financialTypeRadio.value : 'non-financial';
            const isFinancial = financialType === 'financial';
            
            const contactNumbers = [
                document.getElementById('contact-number-1').value,
                document.getElementById('contact-number-2').value
            ].filter(n => n);

            return {
                name: document.getElementById('event-name').value,
                date: document.getElementById('event-date').value,
                time: document.getElementById('event-time').value,
                location: document.getElementById('event-location').value,
                category: document.getElementById('event-category').value,
                hostingFaculty: document.getElementById('hosting-faculty').value || "UCSC (Mock)", 
                description: document.getElementById('event-description').value,
                contactNumbers: contactNumbers.join(', '), 
                
                audience: {
                    members: audienceMembers.checked,
                    guests: document.getElementById('audience-guests').checked,
                    targetFaculties: audienceMembers.checked ? targetFaculties : []
                },
                
                financialType: financialType,
                financialDetails: isFinancial ? {
                    specialRate: parseFloat(document.getElementById('special-rate').value),
                    generalPrice: parseFloat(document.getElementById('general-price').value),
                    ticketsAvailable: parseInt(document.getElementById('tickets-available-new').value),
                    
                    beneficiaryName: document.getElementById('beneficiary-name').value,
                    accountNumber: document.getElementById('account-number').value,
                    bankName: document.getElementById('bank-name').value,
                    branchName: document.getElementById('branch-name').value
                } : null,
                
                posterURL: posterURL,
                status: 'pending', 
                postedByUid: 'mock-uid', 
                submissionTimestamp: new Date().toISOString()
            };
        }

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('post-event-form');
            const nextButton = document.getElementById('next-button');
            const backButton = document.getElementById('back-button');
            
            const audienceMembers = document.getElementById('audience-members');
            const facultySelectionGroup = document.getElementById('faculty-selection-group');
            
            const posterUploadArea = document.getElementById('poster-upload-area');
            const hiddenFileInput = document.getElementById('event-poster');
            const posterPreviewImg = document.getElementById('poster-preview-img');
            const posterTextElements = posterUploadArea.querySelectorAll('.main-text, .sub-text');

            const financialYes = document.getElementById('financial-yes');
            const financialNo = document.getElementById('financial-no');
            const financialDetailsGroup = document.getElementById('financial-details-group');
            
            const specialRateInput = document.getElementById('special-rate');
            const generalPriceInput = document.getElementById('general-price');
            const ticketsAvailableNewInput = document.getElementById('tickets-available-new');
            
            const beneficiaryNameInput = document.getElementById('beneficiary-name');
            const accountNumberInput = document.getElementById('account-number');
            const bankNameInput = document.getElementById('bank-name');
            const branchNameInput = document.getElementById('branch-name');

            const contactNumber1 = document.getElementById('contact-number-1');
            const contactNumber2 = document.getElementById('contact-number-2');

            // Format phone numbers as user types
            contactNumber1.addEventListener('input', () => formatPhoneNumber(contactNumber1));
            contactNumber2.addEventListener('input', () => formatPhoneNumber(contactNumber2));

            // Format prices as user types
            specialRateInput.addEventListener('blur', () => formatPrice(specialRateInput));
            generalPriceInput.addEventListener('blur', () => formatPrice(generalPriceInput));

            // Validate and format account number
            accountNumberInput.addEventListener('input', () => validateAccountNumber(accountNumberInput));

            // Format beneficiary name to uppercase
            beneficiaryNameInput.addEventListener('input', () => formatBeneficiaryName(beneficiaryNameInput));

            // Format branch name (first letter capital)
            branchNameInput.addEventListener('input', () => formatBranchName(branchNameInput));

            const updateFinancialRequiredAttributes = (isRequired) => {
                [specialRateInput, generalPriceInput, ticketsAvailableNewInput, beneficiaryNameInput, accountNumberInput, bankNameInput, branchNameInput].forEach(input => {
                    if (isRequired) {
                        input.setAttribute('required', 'required');
                    } else {
                        input.removeAttribute('required');
                        input.value = (input.type === 'number' || input.id === 'bank-name') ? '' : ''; 
                    }
                });
            };

            audienceMembers.addEventListener('change', () => {
                facultySelectionGroup.style.display = audienceMembers.checked ? 'block' : 'none';
                if (audienceMembers.checked) {
                    // Ensure target-faculty is required if audience-members is checked
                    document.getElementById('target-faculty').setAttribute('required', 'required');
                } else {
                    document.getElementById('target-faculty').removeAttribute('required');
                }
            });
            
            financialYes.addEventListener('change', () => {
                if (financialYes.checked) {
                    financialDetailsGroup.style.display = 'block'; 
                    updateFinancialRequiredAttributes(true);
                }
            });

            financialNo.addEventListener('change', () => {
                if (financialNo.checked) {
                    financialDetailsGroup.style.display = 'none';
                    updateFinancialRequiredAttributes(false);
                }
            });

            nextButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentStep === 1 && validateStep1()) {
                    updateSummary();
                    showStep(2);
                }
            });

            backButton.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentStep === 2) {
                    showStep(1);
                }
            });

            form.addEventListener('submit', handleFormSubmission);
            
            // Initialize view 
            showStep(1);

            posterUploadArea.addEventListener('click', (e) => {
                if (e.target !== hiddenFileInput) {
                    hiddenFileInput.click();
                }
            });

            // Handle file selection
            hiddenFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    eventPosterFile = file;
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        posterPreviewImg.src = event.target.result;
                        posterPreviewImg.style.display = 'block';
                        posterTextElements.forEach(el => el.style.display = 'none');
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('Please select a valid image file.');
                }
            });

            posterUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                posterUploadArea.classList.add('drag-over');
            });

            posterUploadArea.addEventListener('dragleave', () => {
                posterUploadArea.classList.remove('drag-over');
            });

            posterUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                posterUploadArea.classList.remove('drag-over');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    if (file.type.startsWith('image/')) {
                        eventPosterFile = file;
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            posterPreviewImg.src = event.target.result;
                            posterPreviewImg.style.display = 'block';
                            posterTextElements.forEach(el => el.style.display = 'none');
                        };
                        reader.readAsDataURL(file);
                    } else {
                        alert('Please drop a valid image file.');
                    }
                }
            });
        });
    </script>
</body>
</html>
